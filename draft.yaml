# ===============================
# VERSI FINAL MODEL DATABASE
# Tanggal: 6 April 2025
# ===============================

models:
  Sekolah:
    nama: string:100
    alamat: text
    logo: string nullable
    status: enum:aktif,nonaktif default:aktif
    timestamps: true
    softDeletes: true
    relationships:
      hasMany: Siswa, Rombel

  # Master Data Kelas (Statis)
  TmKelas:
    # Tingkat kelas
    level: enum:1,2,3,4,5,6
    # Nama Rombel (misal: A, B, C)
    nama_rombel: string:10
    timestamps: true
    softDeletes: true
    relationships:
      # Definisi kelas ini bisa dipakai banyak Rombel
      hasMany: Rombel

  TahunAjaran:
    # Format: YYYY/YYYY (misal: 2024/2025)
    tahun: string:9 unique
    # Nama deskriptif (misal: Tahun Ajaran 2024/2025)
    nama: string:100
    status: enum:aktif,nonaktif default:nonaktif
    timestamps: true
    softDeletes: true
    relationships:
      hasMany: Semester, Rombel

  Semester:
    nama: enum:Ganjil,Genap default:Ganjil
    tahun_ajaran_id: foreignId
    status: enum:aktif,nonaktif default:aktif
    timestamps: true
    softDeletes: true
    relationships:
      belongsTo: TahunAjaran
      # Semester memiliki banyak record hafalan & rekap semester
      hasMany: HafalanSiswa, RekapSemesterSiswa

  # Rombongan Belajar (Instansi Kelas per Tahun Ajaran)
  Rombel:
    tahun_ajaran_id: foreignId
    tm_kelas_id: foreignId
    # Memudahkan query langsung ke sekolah
    sekolah_id: foreignId
    # guru_id: foreignId # Opsional: jika ada tabel Guru (Wali Kelas)
    # Nama spesifik (misal: Kelas 1A TA 2024/2025)
    nama_rombongan: string:100
    status: enum:aktif,nonaktif default:aktif
    timestamps: true
    softDeletes: true
    indexes:
      # Pastikan kombinasi unik
      unique: [tahun_ajaran_id, tm_kelas_id]
    relationships:
      belongsTo: TahunAjaran, TmKelas, Sekolah
      # belongsTo: Guru # (Opsional)
      # Rombel ini memiliki banyak siswa
      hasMany: Siswa
      # Bisa akses hafalan siswa di rombel ini
      # hasManyThrough definition removed - Add manually to Rombel model after build

  Siswa:
    nama: string:100
    nis: string:20 unique
    # Siswa terdaftar di Rombel spesifik
    rombel_id: foreignId
    # Memudahkan query langsung ke sekolah
    sekolah_id: foreignId
    jenis_kelamin: enum:L,P
    status: enum:aktif,nonaktif,lulus,pindah default:aktif
    timestamps: true
    softDeletes: true
    relationships:
      belongsTo: Rombel, Sekolah
      # Siswa punya banyak record hafalan & rekap semester
      hasMany: HafalanSiswa, RekapSemesterSiswa

  Surah:
    # Nomor urut surah
    no: integer unique
    nama: string:100
    timestamps: true
    softDeletes: true
    relationships:
      hasMany: HafalanSiswa

  # Detail Pencapaian Hafalan per Surah per Semester
  HafalanSiswa:
    siswa_id: foreignId
    surah_id: foreignId
    semester_id: foreignId
    # Snapshot tingkat kelas saat dinilai (diambil dari Rombel->TmKelas->level)
    tingkat_kelas: string:10
    # Pertimbangkan tipe data (numeric?)
    nilai: string:10
    status_hafalan: enum:belum,proses,selesai default:belum
    # catatan_spesifik: text nullable # Opsional: jika perlu catatan per surah
    timestamps: true
    softDeletes: true
    indexes:
      # Hanya 1 status per surah per siswa per semester
      unique: [siswa_id, surah_id, semester_id]
    relationships:
      belongsTo: Siswa, Surah, Semester
      hasMany: RiwayatHafalan
      # morphTo: hafalable # Jika ada rencana polimorfisme

  # Riwayat Perubahan pada HafalanSiswa
  RiwayatHafalan:
    hafalan_siswa_id: foreignId
    # Catatan tentang perubahan
    catatan: text
    # Jenis perubahan
    status: enum:baru,diperbarui,dihapus
    # Waktu perubahan terjadi
    tanggal: timestamp
    timestamps: true
    softDeletes: true
    relationships:
      belongsTo: HafalanSiswa
      # morphTo: recordable # Jika ada rencana polimorfisme

  # Rekapitulasi / Catatan Global per Semester per Siswa
  RekapSemesterSiswa:
    siswa_id: foreignId
    semester_id: foreignId
    # Catatan global untuk siswa ini di semester ini
    catatan_global: text nullable
    # Tambahkan field rekap lain jika perlu (misal: nilai_rata2_hafalan)
    timestamps: true
    softDeletes: true
    indexes:
      # Hanya 1 rekap per siswa per semester
      unique: [siswa_id, semester_id]
    relationships:
      belongsTo: Siswa, Semester
